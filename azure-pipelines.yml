trigger:
- main

jobs:
- deployment: RunAngularBuildOnVM
  displayName: 'Run Angular Build on TestDEV VM'
  environment: 'TestDEV'   # This is your Azure DevOps Environment name
  strategy:
    runOnce:
      deploy:
        steps:
          - script: |
              echo "Running Angular build on VM in TestDEV environment..."
              # Install Node.js
              curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
              sudo apt-get install -y nodejs

              # Install Angular CLI and build
              npm install -g @angular/cli
              cd /home/josh.grenitz/project   # Adjust to your code path
              npm install
              ng build --prod --output-path="dist"
          - task: AzureFileCopy@6
            inputs:
              SourcePath: '/home/josh.grenitz/project/dist/'
              azureSubscription: 'Lohith-Visual Studio Professional Subscription(a40b77d3-7a31-4b18-9e78-563134d67d97)'
              Destination: 'AzureVMs'
              storage: 'grenitztestblobstorage'
              resourceGroup: 'GRENITZTESTRG'
              MachineNames: 'GrenitzTest-Linux'
              vmsAdminUserName: 'grenitz-user'
              vmsAdminPassword: 'Gr3nitzT3stPass!'
              TargetPath: '/opt/'
              CleanTargetBeforeCopy: true
              skipCACheck: false